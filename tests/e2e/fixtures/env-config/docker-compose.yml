services:
  # Test 1: With all environment variables set
  app-full-env:
    image: ${IMAGE:-phpeek/php-fpm-nginx:8.3-bookworm}
    container_name: e2e-env-full
    ports:
      - "8096:80"
    volumes:
      - ./public:/var/www/html/public
    environment:
      # Basic Laravel env vars
      APP_NAME: "Expected value from docker-compose"
      APP_ENV: "testing"
      APP_DEBUG: "true"
      APP_KEY: "base64:testkey1234567890123456789012345678"
      APP_URL: "http://localhost:8096"
      APP_TIMEZONE: "UTC"
      # Database
      DB_CONNECTION: "mysql"
      DB_HOST: "localhost"
      DB_PORT: "3306"
      DB_DATABASE: "test_db"
      DB_USERNAME: "test_user"
      DB_PASSWORD: "test_password"
      # Redis
      REDIS_HOST: "redis"
      REDIS_PORT: "6379"
      REDIS_PASSWORD: ""
      REDIS_DB: "0"
      # Cache & Session
      CACHE_DRIVER: "array"
      SESSION_DRIVER: "file"
      QUEUE_CONNECTION: "sync"
      BROADCAST_DRIVER: "log"
      # Mail
      MAIL_MAILER: "smtp"
      MAIL_HOST: "mailhog"
      MAIL_PORT: "1025"
      MAIL_USERNAME: ""
      MAIL_PASSWORD: ""
      MAIL_ENCRYPTION: ""
      MAIL_FROM_ADDRESS: "test@example.com"
      MAIL_FROM_NAME: "Test App"
      # AWS (empty but set)
      AWS_ACCESS_KEY_ID: ""
      AWS_SECRET_ACCESS_KEY: ""
      AWS_DEFAULT_REGION: "us-east-1"
      AWS_BUCKET: ""
      # Logging
      LOG_CHANNEL: "stack"
      LOG_LEVEL: "debug"
      # Laravel specific
      TELESCOPE_ENABLED: "false"
      HORIZON_BALANCE: "simple"
      # Custom override test
      CUSTOM_OVERRIDE: "overridden_value"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost/"]
      interval: 5s
      timeout: 3s
      retries: 10
      start_period: 10s

  # Test 2: With minimal environment variables (test graceful handling)
  app-minimal-env:
    image: ${IMAGE:-phpeek/php-fpm-nginx:8.3-bookworm}
    container_name: e2e-env-minimal
    ports:
      - "8097:80"
    volumes:
      - ./public:/var/www/html/public
    environment:
      # Only bare minimum
      APP_NAME: "Minimal Test"
      APP_ENV: "testing"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost/"]
      interval: 5s
      timeout: 3s
      retries: 10
      start_period: 10s

  # Test 3: No environment variables at all
  app-no-env:
    image: ${IMAGE:-phpeek/php-fpm-nginx:8.3-bookworm}
    container_name: e2e-env-none
    ports:
      - "8098:80"
    volumes:
      - ./public:/var/www/html/public
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost/"]
      interval: 5s
      timeout: 3s
      retries: 10
      start_period: 10s
