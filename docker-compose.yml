services:
  # PHP-FPM Service (Debian Bookworm)
  php-fpm:
    build:
      context: .
      dockerfile: ./php-fpm/8.3/debian/bookworm/Dockerfile
    container_name: phpeek-fpm
    volumes:
      - ./test-app:/var/www/html
    networks:
      - phpeek-network

  # PHP-FPM Dev Service (Debian Bookworm with Xdebug)
  php-fpm-dev:
    build:
      context: .
      dockerfile: ./php-fpm/8.3/debian/bookworm/Dockerfile.dev
    container_name: phpeek-fpm-dev
    volumes:
      - ./test-app:/var/www/html
    networks:
      - phpeek-network
    environment:
      - XDEBUG_MODE=debug
      - XDEBUG_CONFIG=client_host=host.docker.internal client_port=9003
    profiles:
      - dev

  # PHP-CLI Service (Debian Bookworm)
  php-cli:
    build:
      context: .
      dockerfile: ./php-cli/8.3/debian/bookworm/Dockerfile
    container_name: phpeek-cli
    volumes:
      - ./test-app:/var/www/html
    networks:
      - phpeek-network
    command: tail -f /dev/null

  # Nginx Service (Debian Bookworm)
  nginx:
    build:
      context: .
      dockerfile: ./nginx/debian/bookworm/Dockerfile
    container_name: phpeek-nginx
    ports:
      - "8080:80"
    volumes:
      - ./test-app:/var/www/html:ro
    networks:
      - phpeek-network
    depends_on:
      - php-fpm

  # PHP-FPM + Nginx Multi-Service (Debian Bookworm)
  php-fpm-nginx:
    build:
      context: .
      dockerfile: ./php-fpm-nginx/8.3/debian/bookworm/Dockerfile
    container_name: phpeek-fpm-nginx
    ports:
      - "8081:80"
    volumes:
      - ./test-app:/var/www/html
    networks:
      - phpeek-network
    environment:
      - LARAVEL_SCHEDULER=true
      - LARAVEL_AUTO_OPTIMIZE=false
    profiles:
      - multi

networks:
  phpeek-network:
    driver: bridge
